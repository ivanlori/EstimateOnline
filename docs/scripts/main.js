"use strict";!function(){var e=document.querySelector(".js-datepicker"),t=document.querySelector(".js-vat"),a=document.querySelector(".js-vat-display"),n=document.querySelector(".js-company-address"),r=document.querySelector(".js-discount"),i=document.querySelector(".js-estimate-subtotal"),s=document.querySelector(".js-estimate-total"),o=0,l={variables:{$imgBlank:document.getElementById("js-image-blank"),$logoImageField:document.getElementById("js-logo-image"),$logoWrapper:document.querySelector(".js-logo-wrapper")},getBase64Image:function(e){var t=this.variables.$imgBlank,a=t.getContext("2d"),n=new Image;n.onload=function(){n.height>150?t.height=80:t.height=n.height,t.width=n.width,a.drawImage(n,0,0)},n.src=URL.createObjectURL(e.target.files[0]),t.classList.remove("hidden")},getImageFromStorage:function(){var e=localStorage.getItem("imgData");this.variables.$imgBlank.src="data:image/png;base64,"+e},init:function(){var e=this;this.variables.$logoImageField.addEventListener("change",function(t){var a=e.getBase64Image(t);localStorage.setItem("imgData",a),e.variables.$logoWrapper.classList.add("x-logo-visible")}),this.getImageFromStorage()}},u={variables:{$selectBox:document.querySelector(".js-select"),$firstInputUnity:document.getElementById("js-unity-product-0"),$firstInputAmount:document.getElementById("js-amount-product-0"),$firstInputQuantity:document.getElementById("js-quantity-product-0"),$firstSelectProduct:document.getElementById("js-select-product-0")},isDataTableValid:function(e){var t={},a={},n={},r={};0===e?(t=this.variables.$firstSelectProduct,a=this.variables.$firstInputUnity,n=this.variables.$firstInputAmount,r=this.variables.$firstInputQuantity):(t=document.getElementById("js-select-product-"+e),a=document.getElementById("js-unity-product-"+e),n=document.getElementById("js-amount-product-"+e),r=document.getElementById("js-quantity-product-"+e));var i=parseInt(a.value),s=parseInt(r.value),o=parseInt(n.value);return"0"===t.value?(t.classList.add("error"),!1):(t.classList.remove("error"),!0,isNaN(i)||""===a.value?(a.classList.add("error"),!1):(a.classList.remove("error"),!0,isNaN(s)||""===r.value?(r.classList.add("error"),!1):(r.classList.remove("error"),!0,isNaN(o)||""===n.value?(n.classList.add("error"),!1):(n.classList.remove("error"),!0))))},onQuantityKeyUpHandler:function(e,t,a){var n=""===e.value,r=""===t.value,i=isNaN(t.value),s=isNaN(e.value),o=0;r||i?(t.classList.add("error"),o+=1):t.classList.remove("error"),n||s?(e.classList.add("error"),o+=1):e.classList.remove("error"),0===o&&(a.value=this.calculateSingleAmount(t.value,e.value),this.variables.$firstInputAmount.parentNode.classList.add("x-value"),this.calculateTotalAmount())},calculateTotalAmount:function(){for(var e=0,a=document.getElementsByClassName("js-input-amount"),n="",o="",l="",u="",m=0;m<a.length;m++)e+=parseFloat(a[m].value),""!==t.value&&(o=d(t),l=parseFloat(o)),""!==r.value&&(n=c(r),u=parseFloat(n)),i.innerHTML=e,s.innerHTML=e+l-u+"€"},calculateSingleAmount:function(e,t){return parseFloat(e).toFixed(2)*parseFloat(t).toFixed(2)},createColTable:function(e,t,a,n,r){var i=document.createElement("td"),s=document.createElement(e),o=document.createElement("span");if("select"===e){var l={0:"-- Select --",1:"Service",2:"Hours",3:"Days",4:"Product"};for(var u in l)if(l.hasOwnProperty(u)){var c=document.createElement("option");c.setAttribute("value",u),c.innerHTML=l[u],s.appendChild(c)}}return i.setAttribute("class",t),s.setAttribute("class",a),s.setAttribute("id",n),s.setAttribute("placeholder",r),s.classList.contains("js-input-amount")&&(o.setAttribute("class","amount-euro"),i.appendChild(o)),i.appendChild(s),i},createRowTable:function(e){var t=document.createElement("tr"),a=document.createElement("i");return a.setAttribute("class","icon-minus"),a.setAttribute("id",e),t.classList.add("row"),t.appendChild(this.createColTable("select","js-select-wrapper col small","js-select","js-select-product-"+e,"js-select-product-"+e,"-- Select --")),t.appendChild(this.createColTable("textarea","col large","js-input-description table-field","js-description-product-"+e,"")),t.appendChild(this.createColTable("input","col small","js-input-unity table-field","js-unity-product-"+e,"0.00")),t.appendChild(this.createColTable("input","col small","js-input-quantity table-field","js-quantity-product-"+e,"0")),t.appendChild(this.createColTable("input","amount-col col small","js-input-amount table-field","js-amount-product-"+e,"0.00")),t.appendChild(a),t.setAttribute("id",e),t},addProduct:function(){var e=document.getElementById("js-tbody"),t=this;if(this.isDataTableValid(o)){o+=1,e.appendChild(this.createRowTable(o));var a=document.getElementById("js-unity-product-"+o),n=document.getElementById("js-quantity-product-"+o),r=document.getElementById("js-amount-product-"+o);n.addEventListener("keyup",function(){t.onQuantityKeyUpHandler(this,a,r),r.parentNode.classList.add("x-value")})}},init:function(){var e=this.variables,t=this;document.querySelector("body").addEventListener("click",function(e){e.target.classList.contains("icon-minus")&&(o-=1,e.target.parentNode.remove(),t.calculateTotalAmount())},!1),e.$firstInputQuantity.addEventListener("keyup",function(){t.onQuantityKeyUpHandler(this,e.$firstInputUnity,e.$firstInputAmount)})}},c=function(e){var t="",a="",n="";if(!isNaN(e.value))return e.classList.remove("error"),t=(e.value/100*i.innerHTML).toFixed(2),a=parseFloat(t),n=parseFloat(i.innerHTML),s.innerHTML=n-a+"€",t;e.classList.add("error")},d=function(e){var t="",n="",r="";return isNaN(e.value)?void e.classList.add("error"):(e.classList.remove("error"),a.innerText=e.value,t=(i.innerHTML*e.value/100).toFixed(2),r=parseFloat(t),n=parseFloat(i.innerHTML),s.innerHTML=n+r+"€",t)},m={variables:{$addProductBtn:document.getElementById("js-add-btn"),$printBtn:document.getElementById("js-print-btn"),$previewBtn:document.getElementById("js-preview-btn")},init:function(){function e(){return window.scroll(0,".x-logo-error")}this.variables.$addProductBtn.addEventListener("click",function(){u.addProduct()}),this.variables.$printBtn.addEventListener("click",function(){l.variables.$logoWrapper.classList.contains("x-logo-visible")?window.print():(document.querySelector(".x-logo-error").classList.remove("hidden"),e())}),this.variables.$previewBtn.addEventListener("click",function(){l.variables.$logoWrapper.classList.contains("x-logo-visible")?document.querySelector("body").classList.toggle("x-preview"):(document.querySelector(".x-logo-error").classList.remove("hidden"),e())})}};n.addEventListener("focusin",function(){this.classList.add("expand")}),r.addEventListener("keyup",function(){c(this)}),t.addEventListener("keyup",function(){d(this)}),flatpickr(e,{dateFormat:"d-m-Y"}),l.init(),u.init(),m.init()}();